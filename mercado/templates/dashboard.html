{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard ‚Äì Gr√°ficos</title>
    <link rel="stylesheet" href="{% static 'styledashboard.css' %}">
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{% static 'images/favicons/dashboard.favicon.png' %}">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body  class="fundo-dashboard">
    
<div class="container">

    <a href="{% url 'produtos' %}" 
        target="_blank" 
        rel="noopener noreferrer"
        class="btn-link">
        VER PRODUTOS
    </a>
    
    <h1>üìä Dashboard ‚Äì Resumo de Vendas <br> CONTROLE GERAL</h1>

    <!-- ============================= -->
    <!-- RESUMO DOS 30 DIAS LINHA  -->
    <!-- ============================= -->
    <h2>üìà Vendas dos √öltimos 30 Dias</h2>
    <canvas id="graficoLinha"></canvas>

    <!-- ============================= -->
    <!-- GR√ÅFICO BARRA CATEGORIAS -->
    <!-- ============================= -->
    <h2>üìä Vendas por Categoria</h2>
    <canvas id="graficoCategorias"></canvas>

    <!-- ============================= -->
    <!-- GR√ÅFICO DOUGHNUT PAGAMENTOS -->
    <!-- ============================= -->
    <h2>üí≥ Formas de Pagamento Hoje</h2>
    <canvas id="graficoPagamento"></canvas>

    <!-- LISTA DOS 30 DIAS -->
    <h2>Resumo dos √öltimos 30 Dias</h2>
    <ul class="space-y-3">
    {% for dia, total in vendas_dias.items %}
        {% url 'vendas_por_data' data=dia|date:'Y-m-d' as link_dia %}
       <li>
            <a href="{{ link_dia }}"
            target="_blank"
            rel="noopener noreferrer"
            class="card-link">

        <div class="card-content">
            <strong>{{ dia|date:"d \\d\\e F \\d\\e Y" }}</strong><br>
            {{ total }} produtos vendidos
        </div>

            </a>
        </li>
    {% endfor %}
    </ul>
    

    <a href="{% url 'produtos' %}" 
        target="_blank" 
        rel="noopener noreferrer"
        class="btn-link">
        VER PRODUTOS
    </a>

</div>

<script>
/* =======================================================
   1 GR√ÅFICO DE LINHA ‚Äì Vendas dos √∫ltimos 30 dias
======================================================= */
new Chart(document.getElementById('graficoLinha'), {
    type: 'line',
    data: {
        labels: [
            {% for dia, total in vendas_dias.items %}
                "{{ dia|date:'d/m' }}",
            {% endfor %}
        ],
        datasets: [{
            label: "Produtos Vendidos",
            data: [
                {% for dia, total in vendas_dias.items %}
                    {{ total }},
                {% endfor %}
            ],
            borderColor: "rgba(54, 162, 235, 1)",
            backgroundColor: "rgba(54, 162, 235, 0.3)",
            fill: true,
            tension: 0.3,
            borderWidth: 3
        }]
    },
    options: {
        responsive: true,
        plugins: {
            title: {
                display: true,
                text: "Vendas Di√°rias (√öltimos 30 Dias)",
                font: { size: 18 }
            }
        }
    }
});


/* =======================================================
   2 GR√ÅFICO DE BARRAS ‚Äì Categorias mais vendidas
======================================================= */
new Chart(document.getElementById('graficoCategorias'), {
    type: 'bar',
    data: {
        labels: {{ categorias_labels|safe }},
        datasets: [{
            label: "Total de Vendas",
            data: {{ categorias_totais|safe }},
            backgroundColor: "rgba(255, 159, 64, 0.7)",
            borderColor: "rgba(255, 159, 64, 1)",
            borderWidth: 2
        }]
    },
    options: {
        responsive: true,
        plugins: {
            title: {
                display: true,
                text: "Vendas por Categoria",
                font: { size: 18 }
            }
        },
        scales: {
            y: { beginAtZero: true }
        }
    }
});


/* =======================================================
   3 GR√ÅFICO DOUGHNUT ‚Äì Formas de pagamento hoje
======================================================= */
new Chart(document.getElementById('graficoPagamento'), {
    type: 'doughnut',
    data: {
        labels: [
            {% for item in vendas_por_forma %}
                "{{ item.forma_pagamento|capfirst }}",
            {% endfor %}
        ],
        datasets: [{
            data: [
                {% for item in vendas_por_forma %}
                    {{ item.total }},
                {% endfor %}
            ],
            backgroundColor: [
                "rgba(54, 162, 235, 0.7)",
                "rgba(255, 99, 132, 0.7)",
                "rgba(255, 206, 86, 0.7)",
                "rgba(75, 192, 192, 0.7)",
                "rgba(153, 102, 255, 0.7)"
            ],
            borderWidth: 2
        }]
    },
    options: {
        responsive: true,
        plugins: {
            title: {
                display: true,
                text: "Formas de Pagamento ‚Äì Hoje",
                font: { size: 18 }
            }
        }
    }
});
</script>
</body>
</html>
